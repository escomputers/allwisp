{% extends "base.html" %} 
{% block content %}  
<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1>Aggiungi prodotto/servizio</h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item">
              <a href="homepage.html">Home</a>
            </li>
            <li class="breadcrumb-item active">Aggiungi prodotto/servizio</li>
          </ol>
        </div>
      </div>
    </div><!-- /.container-fluid -->
  </section><!-- Main content -->

  <section class="content">
   
    <div class="container-fluid">
      
        <!-- left column -->
        <div class="col-xl-12">
         
       <form method="POST"  action="{% url 'aggiungi_offerta'%}" name="aggiungi_offerta">
      {% csrf_token %}
          <div class="card card-warning">
            <div class="card-header">
              <h3 class="card-title">Aggiungi prodotto/servizio</h3>
            </div><!-- /.card-header -->
         <div class="card-body">
                <div class="row">
                  <div class="col-sm-2">
                    <!-- text input -->
                    <div class="form-group">
                      <label for="nomeofferta">Nome prodotto/servizio</label> 
                      {{ form.nomeofferta}}
                    </div>
                  </div>
                   <div class="col-sm-6">
                    <!-- textarea -->
                    <div class="form-group">
                      <label for="descrizione">Dettagli offerta/servizio</label> 
                      {{ form.descrizione}}
                    </div>
                  </div>
                  <div class="col-sm-1">
                    <div class="form-group">
                      <label for="prezzo">Prezzo</label> 
                       {{ form.prezzo}}
                    </div>
                  </div>
                  <div class="col-sm-1">
                    <!-- text input -->
                    <div class="form-group">
                      <label for="iva">iva</label> 

                      {{ form.iva}}
                    </div>
                  </div>
                  <div class="form-group">
                      <label for="totaleivato1">Totale ivato</label> 

                      <input id="totaleivato1" type="text" class="form-control"  disabled name="totaleivato1">
                       {{ form.totaleivato}}
                    </div>
                  </div>
				  
         <div class="col-sm-2">
         <input type="submit" value='Submit' name="submit" placeholder="salva" class="btn btn-success"/>
         </div>
		 
               <div class="row">
                  <div class="col-sm-10">
                    <br>
                    <br>
                    <h6><strong><bold><italic><font color="#fe5000">Attenzione:</font></h6></strong></bold></italic>
                    <br>
                   <h6><strong><bold><italic>Tutti i campi eccetto la descrizione dei dettagli sono obbligatori.Nel campo iva devi inserire soltanto il valore dell'aliquota iva senza altre aggiunte (esempio: iva 22% devi inserire solo 22 oppure iva 5% devi inserire 5) </h6></strong></bold></italic>
                 </div>
                </div>
			  </div>
            <!-- /.card-body -->
          </div>
         
          	</form>
          </div>
         <!-- /.card-body -->
          </div><!-- /.card -->
      <!--/.col (right) -->

  </section>
</div>


<script type="text/javascript">
$(function() {
  // Handler for .ready() called.
  $("#iva").keyup(function () {
        updatePrice();
    });
    $("#prezzo" ).keyup(function () {
        updatePrice();
    });
});


function updatePrice(){
    var prezzo = $('#prezzo').val();
    var iva = Number($('#iva').val());
	var prezzo_def = parseFloat(prezzo.replace(',','.').replace(' ',''))
    var calc_iva = iva/100;
	var xd = prezzo_def * calc_iva;
    var total = prezzo_def + xd;
    $("#totaleivato").val(total.toFixed(2));
    $("#totaleivato1").val(total.toFixed(2));
}
</script>

<script type="text/javascript">
  $('#prodotto').submit(function(event){
        event.preventDefault();
        var $prodotto = $(this);
        $.ajax({
        type: 'post',
        url: "{% url 'aggiungi_offerta'%}",
        data:{csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(), 
          data:$prodotto.serialize()},
        success: function($prodotto) {
        alert("I dati sono stati correttamente salvati");
        console.log(data)
        },
        error: function(error) {
        alert("I dati non sono stati salvati, controlla e reinvia");
        console.log(error)
        }
        });
        });
  
</script>
{% endblock %}