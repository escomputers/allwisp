<script type="text/javascript">

var risultato_checkbox_sconto={};//dichiarazione variabile globale
var spese_spedizione={};
spese_spedizione=0;
var altrioneri_fattura={};
altrioneri_fattura=0
risultato_checkbox_sconto='cifra';


var sconto_applicato={};
sconto_applicato=0


$(function() {


 //----------------- titoli e colorazione tipo fattura e scadenza-----------------------
  
  
  var tipo_documento=$('#tipo_documento').text();
 
  if(tipo_documento=="Nota di credito")
 


  {
    
    $('#scadenza_documento').hide()

  }


  else if(tipo_documento=="Preventivo"){
    $('#titolo_scadenza_documento').text('Scadenza preventivo')
    $('#titolo_scadenza_documento').css("color","red")
   
 
  };

    //----------------------fine------------------------




//-------------per cambiare i valori del checkbox e valore sconto-----------------------
  $('#checkboxsconto ').click(function(){ 
  //------- per la selezione dello sconto in percentuale o no----------


    var checkbox_dello_sconto=document.getElementById('checkboxsconto');  
    
   // primo if
    
    if(checkbox_dello_sconto.checked) {

      risultato_checkbox_sconto='percentuale'

      $("#label_sconto").text("Deseleziona per inserire lo sconto in unità di valuta");
      
      //fare clacoli percentuale

      var totsubtot=parseFloat($('#tasse_escluse').text());
      var iva= parseFloat($('#tot_iva').text());
      var totale_fattura_ = totsubtot + iva
      var valore_per_cento_sconto=parseFloat($('#campo_sconto').val());
   
      var sconto=(totale_fattura * valore_per_cento_sconto)/100
      var totale_fattura_con_sconto=totale_fattura - sconto

     //condizione primo if
      if(totale_fattura_con_sconto > 0){
        
        $('#totale_della_fattura').text(totale_fattura_con_sconto)
        $('#sconto_applicato').text(sconto)

      } 
      
      else{
        
        alert("attenzione hai inserito uno sconto maggiore dell'importo della fattura, si prega di sistemare!");

        $('#totale_della_fattura').text('0.00');
        $('#sconto_applicato').text(sconto);

      }



  }//fine condizione primo if
  

  else{

    risultato_checkbox_sconto='cifra'
    $("#label_sconto").text('Seleziona per inserire lo sconto in percentuale');
    
    //fare calcoli unità valuta
      var totsubtot=parseFloat($('#tasse_escluse').text());
      var iva= parseFloat($('#tot_iva').text());
      var totale_fattura = totsubtot + iva
      var sconto=parseFloat($('#campo_sconto').val());
      var totale_fattura_con_sconto=totale_fattura - sconto
    
   

    //secondo if condizione else
   
    if(totale_fattura_con_sconto>0){
    
    $('#totale_della_fattura').text(totalefatturaconsconto)
    $('#sconto_applicato').text(sconto)

  } 
  
  else{
    alert("attenzione hai inserito uno sconto maggiore dell'importo della fattura, si prega di sistemare!")
    $('#totale_della_fattura').text('0.00')
    $('#sconto_applicato').text(sconto)

  } //fine else della seconda condizione di else


} //fine condizione della verifica del checkbox

  
 }); //----------------------fine evento del calcolo per il checkbox------------------


  


  //-----------------------per il calcolo della scadenza fattura--------------------------

  var options0 = { year: 'numeric', month: 'numeric', day: 'numeric' }
   var selezione_scadenza0=parseInt($('#selezionascadenza').val());
   var date=new Date();
   date.setDate(date.getDate() + selezione_scadenza0);
   var data_formattata=date.toLocaleDateString("it-IT", options0);
   $('#scadenza').text(data_formattata)
   $('#invoicedate').text(date)
   

   $('#selezionascadenza').change(function(){
   var scadenza=new Date();
   var selezione_scadenza=parseInt($('#selezionascadenza').val());
   var options = { year: 'numeric', month: 'numeric', day: 'numeric' };//se si usa long(al posto del numeric si vedrà il nome corrispondente), si può mettere weekday per sapere il giorno della data

   scadenza.setDate(scadenza.getDate() + selezione_scadenza);
   var a=scadenza.toLocaleDateString("it-IT", options);
   $('#scadenza').text(a)

  });
  



  //------------------------fine caloclo scadenza fattura---------------------------


});
</script>

<script type="text/javascript">
  
$(document).ready(function(){//per i calcoli fattura in fattura e ricalcolo aumento riga

$('table').on('change', 'input','keyup', function(){// fare ogni volta che cambia il valore die campi
  thisRow = $(this).parent().parent();//prende la riga della tabella
   var quantita  = Number(thisRow.find('td > .quantita').val());   // trova il valore di quantità
    var prezzo = Number(thisRow.find('td > .prezzo').val()); // trova il valore di prezzo(di ogni prezzo)
    var iva = Number(thisRow.find('td > .tax').val());//trova il valore dell'iva
    
    thisRow.find('td>.totale').val('');//azzera il valore di totale
    
    thisRow.find('td>.prezzo_sub_tot').val('');//azzera il valore di prezzo_sub_totale
    
    
    

    var subtotaleriga=prezzo*quantita
    
    var percento=(subtotaleriga*iva)/100
   
    var totaleriga=subtotaleriga+percento
    
    thisRow.find('td>.prezzo_sub_tot').val(subtotaleriga);
    thisRow.find('td>.totale').val(totaleriga);
    
    

    //inizio calcoli
    var totaleconiva = 0;
    var quotasubtot = 0;
    
    var totalesconto=0
    spese_spedizione=0;
    altrioneri_fattura=0;
    spese_spedizione=parseFloat($('#spese_spedizione ').val());
    altrioneri_fattura=parseFloat($('#altri_oneri_fattura ').val());



  $(".prezzo_sub_tot").each(function(){
        quotasubtot += +$(this).val();
    });


    $(".totale").each(function(){//per ognio campo totale
        totaleconiva += +$(this).val();
    });

    var totaleiva=totaleconiva-quotasubtot

    
    //--------------------------------inizio calcolo sconto-----------------------------

   
  sconto_applicato=parseFloat($('#campo_sconto').val());

  if (risultato_checkbox_sconto =='cifra'){ //sconto in unità di valuta
    $('#sconto_applicato').text(sconto_applicato)
    totalesconto=sconto_applicato
  }



  else if(risultato_checkbox_sconto =='percentuale'){//sconto in percentuale
    var somma_dello_sconto=sconto_applicato/100
    $('#sconto_applicato').text(sconto_applicato + '%')
     totalesconto=totaleconiva*somma_dello_sconto
  };

  


   var totalefatturasconto1=totaleconiva - totalesconto
   var totalescontato2 = totalefatturasconto1 + altrioneri_fattura + spese_spedizione

  //---------------------------fine calcolo sconto-----------------------------------------


if(totalescontato2>0){
  totalescontato2=0.00
  $('#totale_della_fattura').text(totalescontato2);
}
else{
  alert("Attenzione, hai inserito uno sconto maggiore dell'imponibile, si prega di sistemare");
  $('#totale_della_fattura').text('0.00');
}
   
  



//--------------stampa nella tabella riepilogativa--------------------------

  $("#cost_spedizioni").text(spese_spedizione)
  $("#altri_oneri").text(altrioneri_fattura)
  $("#tasse_escluse").text(quotasubtot)
  $("#tot_iva").text(totaleiva)
  $('#totale_della_fattura').text(totalescontato2)

//-------------------------------fine stampa------------------------
});


});





</script>




<script type="text/javascript"> //per la tabella dinamica
  
  jQuery(document).on('a.add-record', 'click', function(e) {//per clonare la riga
     e.preventDefault();    
     var content = jQuery('#sample_table tr'),
     size = jQuery('#tbl_posts >tbody >tr').length + 1,
     element = null,    
     element = content.clone();
     element.attr('id', 'rec-'+size);
     element.find('.delete-record').attr('data-id', size);
     element.appendTo('#tbl_posts_body');
     element.find('.sn').html(size);

});



  jQuery(document).on('a.delete-record', 'click', function(e) {// per rimuovere la riga
     e.preventDefault();    
     var didConfirm = confirm("Sei sicuro di volere eleminare questa riga?");
      if (didConfirm == true) {
      var id = jQuery(this).attr('data-id');
      var targetDiv = jQuery(this).attr('targetDiv');
      jQuery('#rec-' + id).remove();

   //inizio calcolo tabella   quando si elimina elemento


   spese_spedizione=0;
   altrioneri_fattura=0;

   spese_spedizione=parseFloat($('#spese_spedizione ').val());
   altrioneri_fattura=parseFloat($('#altri_oneri_fattura ').val());
   var totaleconiva = 0;
   var quotasubtot = 0 ;
   var totalesconto = 0 ;

   $(".prezzo_sub_tot").each(function(){//calcolo del subtotale
        quotasubtot += +$(this).val();
    });


    $(".totale").each(function(){//calcolo del totale
        totaleconiva += +$(this).val();
    });

    var totaleiva=totaleconiva-quotasubtot//calcolo quota iva
        
    $('#tbl_posts_body tr').each(function(index) {// per rigenerare l'indice dei prodotti
      $(this).find('span.sn').html(index+1);
       });
       return true;
        } else {
        return false;
        }


  
    
   
    //----------------------------calcolo dello sconto eliminazione riga----------------------
        sconto_applicato=0
        sconto_applicato=parseFloat($('#campo_sconto').val());

        if(risultato_checkbox_sconto =='cifra'){ //sconto in unità di valuta
          $('#sconto_applicato').text(sconto_applicato)
          totalesconto=sconto_applicato
        }



        else if(risultato_checkbox_sconto =='percentuale'){//sconto in percentuale
          var somma_dello_sconto=sconto_applicato/100
          $('#sconto_applicato').text(sconto_applicato + '%')
           totalesconto=totaleconiva*somma_dello_sconto
        };

        
  
    //---------------------------fine calcolo sconto-----------------------------------------
  var totalefatturasconto=totaleconiva - totalesconto
  var totalescontato = totalefatturasconto + altrioneri_fattura + spese_spedizione




if(totalescontato>0){
  totalescontato=0.00
  $('#totale_della_fattura').text(totalescontato);
}
else{
  alert("Attenzione, hai inserito uno sconto maggiore dell'imponibile, si prega di sistemare");
  $('#totale_della_fattura').text('0.00');
}
          

//visualizzazione nella tabella riepilogativa
  $("#cost_spedizioni").text(spese_spedizione);
    $("#altri_oneri").text(altrioneri_fattura);
    $("#tasse_escluse").text(quotasubtot);
    $("#tot_iva").text(totaleiva);
});
</script>



//da inserire dopo la dichiarazione di variabile e script di caricamento pagina


<script type="text/javascript">
  
$('#campo_sconto').on('change','input'(function(){
    
    sconto_applicato=0
    sconto_applicato=parseFloat($('#campo_sconto').val());
    var totaleconiva=0;
    spese_spedizione=0;
    spese_spedizione=parseFloat($('##spese_spedizione').val());
    altrioneri_fattura=0;
    var totalesconto=0
    altrioneri_fattura=parseFloat($('#altri_oneri_fattura').val());


    $(".totale").each(function(){//per ognio campo totale
        totaleconiva += +$(this).val();
    });
        

    if(risultato_checkbox_sconto =='cifra'){ //sconto in unità di valuta
      $('#sconto_applicato').text(sconto_applicato)
      totalesconto=sconto_applicato
    }



    else if(risultato_checkbox_sconto =='percentuale'){//sconto in percentuale
      var somma_dello_sconto=sconto_applicato/100
      $('#sconto_applicato').text(sconto_applicato + '%')
       totalesconto=totaleconiva*somma_dello_sconto
    };

  var totalefatturasconto=totaleconiva  - totalesconto
    var totalescontato = totalefatturasconto + altrioneri_fattura+spese_spedizione

if(totalescontato>0){
  totalescontato=0.00
  $('#totale_della_fattura').text(totalescontato);
}
else{
  alert("Attenzione, hai inserito uno sconto maggiore dell'imponibile, si prega di sistemare");
  $('#totale_della_fattura').text('0.00');
}

});

</script>