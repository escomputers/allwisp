from __future__ import unicode_literals
import os
import datetime
from django import forms
from django.db import connections
from django.core.files.storage import FileSystemStorage
from django.db import models
from phonenumber_field.modelfields import PhoneNumberField
from phonenumber_field.widgets import PhoneNumberPrefixWidget
from attachment.models import InvoiceAttachment, ExpenseAttachment
from expenses.models import Expense
from items.models import InvoiceItem, offertainternet, cadenzapagamento, metodopagamento, offertavoip
from invoices.models import Invoice
from internationalflavor.vat_number import VATNumberField
from internationalflavor.iban import IBANField




# Create your models here.
class Customer (models.Model):
	customer_id=models.IntegerField(blank=True)
	ragionesociale = models.CharField(max_length=256, blank=True)
	scelta_fattura = models.BooleanField()
	codicefiscale = models.CharField(max_length=256,blank=True)
	piva = VATNumberField(max_length=256, blank=True)
	codiceunivoco_sdi = models.CharField(max_length=20, blank=True)
	pec = models.EmailField(blank=True, null=True)
	indirizzo_res = models.CharField(max_length=256,blank=True)
	comune_res = models.CharField(max_length=256,blank=True)
	cap_res = models.CharField(max_length=256,blank=True)
	prov_res = models.CharField(max_length=256,blank=True)
	indirizzo_inst = models.CharField(max_length=256, blank=True)
	comune_inst = models.CharField(max_length=256, blank=True)
	cap_inst = models.CharField(max_length=256, blank=True)
	prov_inst = models.CharField(max_length=256, blank=True)
	email = models.EmailField(blank=True, null=True)
	recapito_tel = PhoneNumberField(default='+39', blank=True, null=True)
	fax = PhoneNumberField(blank=True, default='+39', null=True)
	coordinate_gps = models.CharField(max_length=512, blank=True, null=True)
	offerta_internet = models.ForeignKey(offertainternet, on_delete=models.CASCADE,blank=True, null=True,  related_name="tags") 
	cadenza_pagamento = models.ForeignKey(cadenzapagamento, on_delete=models.CASCADE, blank=True, null=True,  related_name="tags") 
	metodo_pagamento = models.ForeignKey(metodopagamento, on_delete=models.CASCADE, blank=True, null=True,  related_name="tags") 
	importo_attivazione = models.FloatField(blank=True, null=True)
	importo_offerta_dedicata = models.FloatField(blank=True,null=True)
	codice_iban = IBANField(blank=True)
	spese_invio_bolletta = models.FloatField(blank=True,null=True)
	offerta_voip =models.ForeignKey(offertavoip, on_delete=models.CASCADE,blank=True,  null=True,  related_name="tags")
	numero_voip =numero_voip =PhoneNumberField(blank=True, null=True)
	nodo = models.CharField(max_length=128, blank=True)
	ip_statico = models.GenericIPAddressField(blank=True, null=True)
	mac_adress = models.CharField(max_length=128, blank=True)
	stato_cliente_dato=models.CharField(max_length=128, blank=True) 
	note = models.TextField(blank=True)
	data_installazione=models.DateField(blank=True, null=True)
	data_inizio_contratto=models.DateField(blank=True, null=True)
	data_fine_contratto=models.DateField(blank=True, null=True)
	data_contattato=models.DateField(blank=True, null=True)
	data_contattare_stabilito_cliente=models.DateField(blank=True, null=True)
	data_da_contattare=models.DateField(blank=True, null=True)

	

	def __str__(self):
		return self.ragionesociale
	
	def invoices(self):
		return Invoice.objects.filter(customer=self).count()

