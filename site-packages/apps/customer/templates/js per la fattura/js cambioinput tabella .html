<script type="text/javascript">
  
$(document).ready(function(){//per i calcoli fattura in fattura e ricalcolo aumento riga

$('table').on('change', 'input','keyup', function(){// fare ogni volta che cambia il valore die campi
  thisRow = $(this).parent().parent();//prende la riga della tabella
   var quantita  = Number(thisRow.find('td > .quantita').val());   // trova il valore di quantità
    var prezzo = Number(thisRow.find('td > .prezzo').val()); // trova il valore di prezzo(di ogni prezzo)
    var iva = Number(thisRow.find('td > .tax').val());//trova il valore dell'iva
    
    thisRow.find('td>.totale').val('');//azzera il valore di totale
    
    thisRow.find('td>.prezzo_sub_tot').val('');//azzera il valore di prezzo_sub_totale
    
    
    

    var subtotaleriga=prezzo*quantita
    
    var percento=(subtotale*iva)/100
   
    var totaleriga=subtotale+percento
    
    thisRow.find('td>.prezzo_sub_tot').val(subtotaleriga);
    thisRow.find('td>.totale').val(totaleriga);
    
    

    //inizio calcoli
    var totaleconiva = 0;
    var quotasubtot = 0;
    
    var totalesconto=0
    spese_spedizione=0;
    altrioneri_fattura=0;
    spese_spedizione=parseFloat($('#spese_spedizione ').val());
    altrioneri_fattura=parseFloat($('#altri_oneri_fattura ').val());



  $(".prezzo_sub_tot").each(function(){
        quotasubtot += +$(this).val();
    });


    $(".totale").each(function(){//per ognio campo totale
        totaleconiva += +$(this).val();
    });

    var totaleiva=totaleconiva-quotasubtot

    
    //--------------------------------inizio calcolo sconto-----------------------------

   
  sconto_applicato=parseFloat($('#campo_sconto').val());

  if (risultato_checkbox_sconto =='cifra'){ //sconto in unità di valuta
    $('#sconto_applicato').text(sconto_applicato)
    totalesconto=sconto_applicato
  }



  else if(risultato_checkbox_sconto =='percentuale'){//sconto in percentuale
    var somma_dello_sconto=sconto_applicato/100
    $('#sconto_applicato').text(sconto_applicato + '%')
     totalesconto=totaleconiva*somma_dello_sconto
  };

  


   var totalefatturasconto1=totaleconiva - totalesconto
   var totalescontato2 = totalefatturasconto1 + altrioneri_fattura + spese_spedizione

  //---------------------------fine calcolo sconto-----------------------------------------


if(totalescontato2>0){
  totalescontato2=0.00
  $('#totale_della_fattura').text(totalescontato2);
}
else{
  alert("Attenzione, hai inserito uno sconto maggiore dell'imponibile, si prega di sistemare");
  $('#totale_della_fattura').text('0.00');
}
   
  



//--------------stampa nella tabella riepilogativa--------------------------

  $("#cost_spedizioni").text(spese_spedizione)
  $("#altri_oneri").text(altrioneri_fattura)
  $("#tasse_escluse").text(quotasubtot)
  $("#tot_iva").text(totaleiva)
  $('#totale_della_fattura').text(totalescontato)

//-------------------------------fine stampa------------------------
});


});





</script>
