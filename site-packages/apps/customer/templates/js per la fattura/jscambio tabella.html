

<script type="text/javascript"> //per la tabella dinamica
  
  jQuery(document).on('a.add-record', 'click', function(e) {//per clonare la riga
     e.preventDefault();    
     var content = jQuery('#sample_table tr'),
     size = jQuery('#tbl_posts >tbody >tr').length + 1,
     element = null,    
     element = content.clone();
     element.attr('id', 'rec-'+size);
     element.find('.delete-record').attr('data-id', size);
     element.appendTo('#tbl_posts_body');
     element.find('.sn').html(size);

});



  jQuery(document).on('a.delete-record', 'click', function(e) {// per rimuovere la riga
     e.preventDefault();    
     var didConfirm = confirm("Sei sicuro di volere eleminare questa riga?");
      if (didConfirm == true) {
      var id = jQuery(this).attr('data-id');
      var targetDiv = jQuery(this).attr('targetDiv');
      jQuery('#rec-' + id).remove();

   //inizio calcolo tabella   quando si elimina elemento


   spese_spedizione=0;
   altrioneri_fattura=0;

   spese_spedizione=parseFloat($('#spese_spedizione ').val());
   altrioneri_fattura=parseFloat($('#altri_oneri_fattura ').val());
   var totaleconiva = 0;
   var quotasubtot = 0 ;
   var totalesconto = 0 ;

   $(".prezzo_sub_tot").each(function(){//calcolo del subtotale
        quotasubtot += +$(this).val();
    });


    $(".totale").each(function(){//calcolo del totale
        totaleconiva += +$(this).val();
    });

    var totaleiva=totaleconiva-quotasubtot//calcolo quota iva
        
    $('#tbl_posts_body tr').each(function(index) {// per rigenerare l'indice dei prodotti
      $(this).find('span.sn').html(index+1);
       });
       return true;
        } else {
        return false;
        }


  
    
   
    //----------------------------calcolo dello sconto eliminazione riga----------------------
        sconto_applicato=0
        sconto_applicato=parseFloat($('#campo_sconto').val());

        if(risultato_checkbox_sconto =='cifra'){ //sconto in unitÃ  di valuta
          $('#sconto_applicato').text(sconto_applicato)
          totalesconto=sconto_applicato
        }



        else if(risultato_checkbox_sconto =='percentuale'){//sconto in percentuale
          var somma_dello_sconto=sconto_applicato/100
          $('#sconto_applicato').text(sconto_applicato + '%')
           totalesconto=totaleconiva*somma_dello_sconto
        };

        
  
    //---------------------------fine calcolo sconto-----------------------------------------
  var totalefatturasconto=totaleconiva - totalesconto
  var totalescontato = totalefatturasconto + altrioneri_fattura + spese_spedizione




if(totalescontato>0){
  totalescontato=0.00
  $('#totale_della_fattura').text(totalescontato);
}
else{
  alert("Attenzione, hai inserito uno sconto maggiore dell'imponibile, si prega di sistemare");
  $('#totale_della_fattura').text('0.00');
}
          

//visualizzazione nella tabella riepilogativa
  $("#cost_spedizioni").text(spese_spedizione);
    $("#altri_oneri").text(altrioneri_fattura);
    $("#tasse_escluse").text(quotasubtot);
    $("#tot_iva").text(totaleiva);
});
</script>