{% extends 'base.html' %}

{% block content %}
<style type="text/css">
table#tabellaclienti.dataTable tbody tr:hover {
   background-color:#71d1eb !important;
}



</style>



<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
      
      <div class="row mb-2">
      	     <div class="col-sm-6">
        
        </div>
        
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item">
              <a href="homepage.html">Home</a>
            </li>
            <li class="breadcrumb-item active">Lista_note_di_credito</li>
          </ol>
        </div>
      </div>
    </div><!-- /.container-fluid -->
  </section><!-- Main content -->




{% if lista %}
 



  <section class="content">
<div class="container-fluid">
<div class="col-xl-12">
  <div class="card card-orange">
    <div class="card-header">

  <h1 class="card-title">Lista note di credito</h1>
</div>
<div class="card-body">




<div class="row">
	<div class="col-sm-6">
          <h4>Crea nuovo documento fiscale<a type="button"  class="btn btn-sm " href="{% url 'new_invoice' %}"><i><img alt="aggiungi-clienti" src="/static/images/piu.svg" width="40px" title="Nuovo cliente"></i></a></h4>
      </div>
</div>


<div class="row"><!--Riepilogo economico-->

<div class="col-sm-12">
      
  <div class="card card-blue">
    <div class="card-header">

  <h1 class="card-title">Lista delle note di credito</h1>
</div>
<div class="card-body">  
        
             
	<table  id="tabellaclienti"  class="table-responsive cell-border compact row-border stripe " style="width:50%">

		<thead>
			<tr>
			<th>Id documento</th>
      <th>Id fattura riferimento</th>
			<th>Ragionesociale</th>
			<th>P.Iva/C.F</th>
			<th>Data emissione</th>
			<th>Data scadeza</th>
			<th>Totale</th>
			<th>Email</th>
			<th>Pec</th>
			<th>Telefono</th>
			<th class=".not-export-col text-center">Azioni possibili</th>
		</tr>
		</thead>
		<tbody>
		{% for liste in lista %}
		<tr>
			<td class="text-center id">{{ liste.invoice_id }}</td>
      <td class="text-center id">{{ liste.invoice.invoice_id }}</td>
			<td class="text-center ragionesociale"><B>{{ liste.invoice.customer.ragionesociale }}</B></td>
			{% if liste.customer.piva %}
			<td class="text-center">{{liste.customer.piva}}</td>
			{% else %}
			<td class="text-center">C.F_  {{liste.invoice.customer.codicefiscale|default_if_none:"Nessuna"}}</td>
			{% endif %}
			<td class="text-center">{{ liste.invoice.date }}</td>
			<td class="text-center">{{ liste.invoice.scadenza_fattura }}</td>
			<td class="text-center">{{ liste.invoice.totale_fattura }}</td>
			<td class="text-center">{{ liste.invoice.customer.email|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ liste.invoice.customer.pec|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ liste.invoice.customer.recapito_tel|default_if_none:'Non fornito' }}</td>
			<td class="text-right">
				<div class="btn-group" role="group">
				<a class="crea_note_credito" href="" class="btn btn-sm"><i><img alt="dettagli-clienti" src="/static/images/find-person.svg" width="32px" title="Dettagli"></i></a>
				<a href="mailto:{{ liste.customer.email }}" class="btn btn-sm "><i><img alt="invia-email" src="/static/images/email.svg" width="32px" title="invia email"></i></a>
				<a href="mailto:{{ liste.customer.email }}" class="btn btn-sm "><i><img alt="invia-sms" src="/static/images/sms-giallo.svg" width="32px" title="invia sms"></i></a>
				<button id="archivia"type="button" data-toggle="modal" data-target="#confirmdelete" data-object-name="{{ customer.ragionesociale }}" data-delete-url="#" class="btn btn-sm"><i><img alt="archivia" src="/static/images/archivia.svg" width="32px" title="archivia cliente"></i></button>
	</div>
			</td>
		</tr>
		{% endfor %}
		</tbody>
		<tfoot>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			
		</tfoot>
	</table>
</div></div></div>
</div>


<!-- Delete confirmation modal -->
<div class="modal fade" id="confirmdelete" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Conferma</h4>
			</div>
			<div class="modal-body">

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">No</button>
				<a href="#" class="btn btn-danger">Si</a>
			</div>
		</div>
	</div>

</div>
</div>
</div>
</div>
</section>
</div>



<!--Questo script serve per la finestra modale dell'archiviazione dei clienti.
								|
								|
								V			
-->

<script>
	$(document).ready(function() {
		$('#confirmdelete').on('show.bs.modal', function(e) {
			var ragionesociale = $(e.relatedTarget).data('object-name');
			var url = $(e.relatedTarget).data('delete-url');
			$('#confirmdelete .modal-body').html("Sei sicuro di volere archiviare il cliente " + ragionesociale + "?<br><i>Questo toglierà la riccorenza delle fatture, ogni addebito o offerta del cliente. Una volta archiviato il sistema produrrà l'ultima fattura. Se si vorrà attivare succeisavemnte il cliente lo si potrà fare nell'area dedicata</i>");
			$('#confirmdelete .modal-footer a').attr('href', url);
		});
	});
</script>
<!--Questo script serve per la tabella dinamica. InitComplete serve per modificare i pulsanti da testo a icona.
	il dom serve a indicare ogni elemento della tabella e come devono essere sistemaati. Le lettere rappresentano:
	B=pulsanti, l=select per i risultati in una pagina, t=tabella, p=paginazione, i=informazioni di righe sulla tabella, f=filtro, barra delle ricerche. Per cambiare la lingua del plugin bisogna allegare l'url per language alla lingua corretta)
								|
								|
								V			
-->
<script type="text/javascript">
	$(document).ready(function() {
    $('#tabellaclienti').DataTable({
    	initComplete: function () {
                $('.buttons-copy').html('<i><img alt="copia" src="/static/images/icon-copy.svg" width="20px" title="copia tabella"></i>');
                $('.buttons-csv').html('<i><img alt="copia" src="/static/images/icon-csv.svg" width="20px" title="scarica csv"></i>');
                $('.buttons-excel').html('<i><img alt="pdf" src="/static/images/icon-xlsx.svg" width="20px" title="scarica xls"></i>');
                $('.buttons-pdf').html('<i><img alt="pdf" src="/static/images/icon-pdf.svg" width="20px" title="scarica pdf"></i>');
                $('.buttons-print').html('<i><img alt="pdf" src="/static/images/icon-printer.svg" width="20px" title="stampa tabella"></i>');
                 $('.buttons-colvis').html('<i><img alt="pdf" src="/static/images/ordina-tabella.svg" width="20px" title="ordina visualizzazione colonna"> vedi colonne</i>');
                this.api().columns().every( function () {

                var column = this;
                var select = $('<select><option value=""></option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );
                        console.log(val)
 
                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );
 
                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
            } );

                
            },
            
            responsive: true,
            

            fixedHeader: true,
    		dom: "<'row dom_wrapper fh-fixedHeader'l<'col-sm col-md'><'col-sm col-md'>f>" +
    "<'row'<'col-sm col-md'Btr>>" +
    "<'row'<'col-sm col-md'i><'col-sm col-md'>p>",
    		buttons: [

    	

    		{
                extend: 'copyHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'csvHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'excelHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'pdfHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'print',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
				extend: 'colvis',
				text : 'vedicolonne',
				className: 'btn btn-primary'
			 },
            
  			],
    		language:{
    			"url": "//cdn.datatables.net/plug-ins/1.11.3/i18n/it_it.json",
    			"searchPlaceholder": "Cerca cliente"
},

});
    $("#tabellaclienti").width("100%");

});
</script>
<script type="text/javascript">//questo serve per cambiare i colori dello stato cliente
$(document).ready(function() {
	$("#archivia").click( function()
           {
             $("#data_fine_contratto").val()
           }
        );
});

</script>









<script type="text/javascript">//questo serve per cambiare i colori dello stato cliente




$(document).ready(function() {
	var elements = document.getElementsByClassName("status");

for (var i = 0; i < elements.length; i++) {
  var value = elements[i].innerText || elements[i].textContent;
  
  if (value === 'Scaduta') {
    elements[i].style.backgroundColor = '#a61022';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  } else if (value === 'Pagato' || value ==='pagato contanti') {
    elements[i].style.backgroundColor = '#177245';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }

  else if (value === 'In ritardo') {
    elements[i].style.backgroundColor = ' #ffc107';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
   else if (value === 'non pagato') {
    elements[i].style.backgroundColor = ' #ffc107';
    elements[i].style.color = '#161c2d';
    elements[i].style.fontWeight = "bold" 
  }
 
}

});
</script>

<script type="text/javascript">//questo serve per cambiare i colori dello stato cliente
$(document).ready(function() {
	var elements = document.getElementsByClassName("id");
	var ragionesociale=document.getElementsByClassName("ragionesociale");
for (var i = 0; i < elements.length; i++) {
  var value = elements[i].innerText || elements[i].textContent;
  
  if (value !== '') {
    elements[i].style.backgroundColor = '#467fd0';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  } 
 
}

for (var i = 0; i < ragionesociale.length; i++) {
  var value = ragionesociale[i].innerText || ragionesociale[i].textContent;
  
  if (value !== '') {
    ragionesociale[i].style.backgroundColor = '#ffc107';
    ragionesociale[i].style.color = '#161c2d';
    ragionesociale[i].style.fontWeight = "bold" 
  } 
 
}

});
</script>



<!-- END delete confirmation modal -->

{% else %}

<div class="alert alert-warning">Nessuna fattura!</div>

{% endif %}
</div>
</section>
</div>


{% endblock %}
