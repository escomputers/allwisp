{% extends 'base.html' %}
{% load static %}

{% block content %}


{% if customers %}
 <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
	<div class="col-sm-6">
	  <h2>Lista Clienti</h2>
	</div>

		<div class="col-sm-6">
		<div class="card card-info">
		<div class="card-header">
		<h3 class="card-title"><font color="#fffff">Ultimo ID cliente inserito:&nbsp;{{ultimoid.customer_id}}</font></h3>
		</div>
		</div>
		</div>

</div>

  </div>
  </section>
<section class="content">
<div class="container-fluid">
<div class="panel panel-primary">

	<div class="row mb-2">
	
		<div class="col-sm-6">
		</div>
		
		<div class="col-sm-6">
		
		<div class="alert alert-warning alert-dismissible">
		<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
		<h5><i class="icon fas fa-exclamation-triangle"></i> Suggerimento!</h5>
			Non superare 11 colonne visualizzate, se si eccede nel numero si potrebbe presentare qualche problema nella visualizzazione.
			</div>
		
		</div>
	</div>
      
	<table  id="tabellaclienti"  class="cell-border compact row-border stripe" style="width:100%">

		<thead>
			<tr>
			<th>ID cliente</th>
			<th>Ragione sociale</th>
			<th>Codice Fiscale</th>
			<th>P.IVA</th>
			<th>Comune res</th>
			<th>Prov res</th>
			<th>Comune inst</th>
			<th>Prov inst</th>
			<th>Email</th>
			<th>Pec</th>
			<th>Telefono</th>
			<th>Offerta</th>
			<th>Offerta Voip</th>
			<th>Metodo pagamento</th>
			<th>Cadenza pagamento</th>
			<th>Stato cliente</th>
			<th class=".not-export-col text-center">Azioni possibili</th>
		</tr>
		</thead>
		<tbody>
		{% for customer in customers %}
		<tr>
			<td class="text-center">{{ customer.customer_id }}</td>
			<td class="text-center"><B>{{ customer.ragionesociale }}</B></td>
			<td class="text-center">{{ customer.codicefiscale|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.piva|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.comune_res|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.prov_res|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.comune_inst|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.prov_inst|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.email|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.pec|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.recapito_tel|default_if_none:'Non fornito' }}</td>
			{% if customer.offerta_internet %}
			<td class="text-center">{{customer.offerta_internet}}</td>
			{% else %}
			<td class="text-center">{{customer.importo_offerta_dedicata|default_if_none:"Nessuna"}}</td>
			{% endif %}
			<td class="text-center">{{ customer.offerta_voip|default_if_none:'Nessuna'}}</td>
			<td class="text-center">{{ customer.metodo_pagamento|default_if_none:'Non fornito' }}</td>
			<td class="text-center">{{ customer.cadenza_pagamento|default_if_none:'Non selezionato' }}</td>
			<td class="visualizza-stato text-center">{{ customer.stato_cliente_dato|default_if_none:'Nessuna' }}</td>
			<td class="text-right">
				<div class="btn-group" role="group">
				<a href="{% url 'update' customer.id %}" class="btn btn-sm"><i><img alt="dettagli-clienti" src="/static/images/find-person.svg" width="32px" title="Dettagli"></i></a>
				<a href="mailto:{{ customer.email }}" class="btn btn-sm "><i><img alt="invia-email" src="/static/images/email.svg" width="32px" title="invia email"></i></a>
				<a href="mailto:{{ customer.email }}" class="btn btn-sm "><i><img alt="invia-sms" src="/static/images/sms-giallo.svg" width="32px" title="invia sms"></i></a>
				<button id="archivia"type="button" data-toggle="modal" data-target="#confirmdelete" data-object-name="{{ customer.ragionesociale }}" data-delete-url="{% url 'archivia_customer' customer.id %}" class="btn btn-sm"><i><img alt="archivia" src="/static/images/archivia.svg" width="32px" title="archivia cliente"></i></button>
	</div>
			</td>
		</tr>
		{% endfor %}
		</tbody>
		<tfoot>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tfoot>
	</table>
</div>


<!-- Delete confirmation modal -->
<div class="modal fade" id="confirmdelete" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Conferma</h4>
			</div>
			<div class="modal-body">

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">No</button>
				<a href="#" class="btn btn-danger">Si</a>
			</div>
		</div>
	</div>
</div>

</div>
</section>
</div>



<!--Questo script serve per la finestra modale dell'archiviazione dei clienti.-->
<script>
	$(document).ready(function() {
		$('#confirmdelete').on('show.bs.modal', function(e) {
			var ragionesociale = $(e.relatedTarget).data('object-name');
			var url = $(e.relatedTarget).data('delete-url');
			$('#confirmdelete .modal-body').html("Sei sicuro di volere archiviare il cliente " + ragionesociale + "?<br><i>Questo toglierà la riccorenza delle fatture, ogni addebito o offerta del cliente. Una volta archiviato il sistema produrrà l'ultima fattura. Se si vorrà attivare succeisavemnte il cliente lo si potrà fare nell'area dedicata</i>");
			$('#confirmdelete .modal-footer a').attr('href', url);
		});
	});
</script>


<!--Questo script serve per la tabella dinamica. InitComplete serve per modificare i pulsanti da testo a icona. Il dom serve a indicare ogni elemento della tabella e come devono essere sistemaati. Le lettere rappresentano: B=pulsanti, l=select per i risultati in una pagina, t=tabella, p=paginazione, i=informazioni di righe sulla tabella, f=filtro, barra delle ricerche. Per cambiare la lingua del plugin bisogna allegare l'url per language alla lingua corretta)-->
<script type="text/javascript">
	$(document).ready(function() {
    $('#tabellaclienti').DataTable({
    	initComplete: function () {
                $('.buttons-copy').html('<i><img alt="copia" src="/static/images/icon-copy.svg" width="20px" title="copia tabella"></i>');
                $('.buttons-csv').html('<i><img alt="copia" src="/static/images/icon-csv.svg" width="20px" title="scarica csv"></i>');
                $('.buttons-excel').html('<i><img alt="pdf" src="/static/images/icon-xlsx.svg" width="20px" title="scarica xls"></i>');
                $('.buttons-pdf').html('<i><img alt="pdf" src="/static/images/icon-pdf.svg" width="20px" title="scarica pdf"></i>');
                $('.buttons-print').html('<i><img alt="pdf" src="/static/images/icon-printer.svg" width="20px" title="stampa tabella"></i>');
                 $('.buttons-colvis').html('<img alt="pdf" src="/static/images/ordina-tabella.svg" width="20px" title="filtra i dati tabella">Filtra');
                this.api().columns().every( function () {

                var column = this;
                var select = $('<select><option value=""></option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );
                        console.log(val)
 
                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );
 
                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
            } );

                
            },
            
            responsive: true,
             columnDefs: [{//serve per la visibilità delle colonne
      targets: [2,3,4,6,7,9,13,14],
      visible: false,
      searchable: true
    }],

            fixedHeader: true,
    		dom: "<'row dom_wrapper fh-fixedHeader'l<'col-sm col-md'><'col-sm col-md'>f>" +
    "<'row'<'col-sm col-md'Btr>>" +
    "<'row'<'col-sm col-md'i><'col-sm col-md'>p>",
    		buttons: [

    	

    		{
                extend: 'copyHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'csvHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'excelHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'pdfHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'print',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
				extend: 'colvis',
				text : 'vedicolonne',
				className: 'btn btn-primary'
			 },
            
  			],
    		language:{
    			"url": "//cdn.datatables.net/plug-ins/1.11.3/i18n/it_it.json",
    			"searchPlaceholder": "Cerca cliente"
},

});
    $("#tabellaclienti").width("100%");

});
</script>

<!-- Questo serve per cambiare i colori dello stato cliente -->
<script type="text/javascript">
$(document).ready(function() {
	$("#archivia").click( function()
           {
             $("#data_fine_contratto").val()
           }
        );
});
</script>

<!-- Questo serve per cambiare i colori dello stato cliente -->
<script type="text/javascript">
$(document).ready(function() {
	var elements = document.getElementsByClassName("visualizza-stato");

for (var i = 0; i < elements.length; i++) {
  var value = elements[i].innerText || elements[i].textContent;
  
  if (value === 'archiviato') {
    elements[i].style.backgroundColor = '#a61022';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  } else if (value === 'Attivo') {
    elements[i].style.backgroundColor = '#177245';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'Interessato') {
    elements[i].style.backgroundColor = '#0C223F';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'Moroso') {
    elements[i].style.backgroundColor = '#f4a900';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'Disattivato') {
    elements[i].style.backgroundColor = '#676767';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
}

});
</script>




{% else %}
<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
	<div class="alert alert-warning"><h5 class="text-bold text-dark">Nessun cliente!</h5></div>
      <div class="row mb-2">
        <div class="col-sm-6">
		  <a href="{% url 'aggiungi_cliente' %}">
		  <h3 class="text-bold text-dark">Aggiungi cliente
		  <i class="fas fa-user-plus"></i></h3>
		  </a>
		  
      </div>
      </div>
    </div><!-- /.container-fluid -->
  </section><!-- Main content -->
</div>
{% endif %}




{% endblock %}
