{% extends 'base.html' %}

{% block content %}




<style type="text/css">
  .btn-purple, .btn-purple:hover, .btn-purple:active, .btn-purple:visited {
    background-color: #800080 !important;
    color: #ffffff;
}
</style>

<style type="text/css">
  .btn-bluchiaro, .btn-bluchiaro:hover, .btn-bluchiaro:active, .btn-bluchiaro:visited {
    background-color: #007fff !important;
    color: #ffffff;
}
</style>




<style> 

#prezzo_subtot {
 color: black;
}

#prezzo_subtot::placeholder {
  color: black;
}

#total {
  color:black;
}

#total::placeholder {
  color: black;
}

input. {
  background: white;
  outline: none;
  border: none;
}

</style>

{% if error_message %}
<div class="alert alert-danger">{{ error_message }}</div>
{% endif %}





<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
      <div class="col-xl-12">


{% if customer_list %}

  <div class="card card-primary">
    <div class="card-header">

  <h1 class="card-title">Documenti fiscali</h1>
</div>
<div class="card-body">

<form method="POST" name="customer">
  {% csrf_token %}
  
  <div id="testo">  
<div class="row">
  <div class="col-sm-3">
    <h4 id="seleziona_cliente_text">Seleziona un cliente</h4>
</div>
    
    <div class="col-sm-3">
    
    <h4 id="testo_cliente"><font color="#0275d8"></font></h4>
</div>
</div>
</div>
<br>
<br>
      <div class="form-group">
        
        <div class="row">

        <div class="col-sm-3">
          <label class="col-sm-3 control-label">Clienti:</label>
          <select class="form-control" name="ragionesociale" id="ragionesociale">
            <option value="None" selected>Seleziona un cliente</option>
            {% for customer in customer_list %}
            <option value="{{ customer.id }}">{{ customer.ragionesociale }}</option>
            {% endfor %}
          </select>
        </div>
       
         <div class="col-sm-3">
          <label>Tipo  documento:</label>
          <select class="form-control" name="documento" id="documento">
            <option value="None" selected>Seleziona documento</option>
            <option value="fattura">Fattura</option>
            <option value="preventivo">Preventivo</option>
            <option value="nota_di_credito">Nota di credito</option>
          </select>
        </div>

        <div class="col-sm-3" id="trova_fattura">
          <label id='fattura'hidden>Seleziona fattura:</label>
          <select id="selezionafattura" name='selezionafattura' hidden>
            <option value="s"></option>
          </select>
          <br>
         
        </div>



        <div class="col-sm-2">
          <label class="col-sm-3 control-label">Crea:</label><br>
          <input type="Submit" class="btn btn-purple" id="crea_documento" value="Crea documento" disabled="True"/>

    </div>
      </div>
     <br>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />

  <div id ="div_pulsante_cliente" class="row">
  <div class="col-sm-2">
      <a href="{% url 'add_client' %}" class="btn btn-success">Aggiungi cliente</a>

    </div>
      <div class="col-sm-6">
        <p><small><B><font color="#0275d8 "> Per potere proseguire devi selezionare un cliente e il tipo di documento.<br> Qualora il cliente non risultasse nell'elenco dovrai inserirlo prima in angarifica</font></B></small></p>
      </div>
      <br>
      <br>
    </div>
</div>
<!-- Inizio della parte di inserimento prodotti-->
</form>
</div></div></div></div></section></div>




{% endif %}
<script>
  $(function () {
    //Initialize Select2 Elements
    $('.select2').select2()

    //Initialize Select2 Elements
    $('.select2bs4').select2({
      theme: 'bootstrap4'
    })



   
    $("input[data-bootstrap-switch]").each(function(){
      $(this).bootstrapSwitch('state', $(this).prop('checked'));
    })

  })
 
</script>



<script type="text/javascript">
  $(function () {

$('#ragionesociale').change(function(){
   var cliente =$('#ragionesociale').val();
    var documento =$('#documento').val();
    var nomecliente=$('#ragionesociale option:selected').text();
  if(cliente=='None'){
    $('#seleziona_cliente_text').text('Non hai scelto nessun cliente');
    $("#testo_cliente").text("")
    $('#seleziona_cliente_text').css("color","red")
}
  else{
    $('#seleziona_cliente_text').text('Hai selezionato il cliente:');
    $("#testo_cliente").text(nomecliente)
    $("#testo_cliente").css("color","#0275d8")


  }
});



$('#ragionesociale').click(function(){
   var cliente =$('#ragionesociale').val();
    var documento =$('#documento').val();
    

if(documento!='None' && cliente!='None'){

      $('#crea_documento').prop( "disabled", false );
    }
    else{
      $('#crea_documento').prop( "disabled", true );
    };

   
    if (cliente!='None'){
      $('#ragionesociale').prop('disabled',true);
    };
   
});


   
$('#documento').click(function(){
   var cliente =$('#ragionesociale').val();
    var documento =$('#documento').val();

    if(documento!='None' && cliente!='None'){

      $('#crea_documento').prop( "disabled", false );
    }
    else{
      $('#crea_documento').prop( "disabled", true );
    };






});


 $('#ragionesociale').click(function(){

      $('#ragionesociale').prop( "disabled", false );
});   





  })
</script>


<script>//se cambia il cliente scelte fa la ricerca per le fatture relative
        $(document).ready(function () {
            // catch the form's submit event
            $('#ragionesociale').on('change', function(){
                // create an AJAX call
               var ragionesociale=$('#ragionesociale').val()
               var tipo=$('#documento').val()
               $('#seleziona_fattura').empty().append('<option>Seleziona</option>');
              var a='nota_di_credito'
               if(tipo==a){
                $.ajax({
                    data : {
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                      ragionesociale : ragionesociale,
                      },
                    url: "{% url 'ricercainvociecliente' %}",
                     type: 'POST',
                     dataType: 'json',
                    // on success
                    success: function (response) {
                     var array = response.customer_invoice;
                     
                     if (array != ''){

                       for (i in array) {   
                        console.log(array.value)
                                       
                        $("#seleziona_fattura").append("<option value="+array[i].invoice_id+">"+array[i].invoice_id+"</option>");//per prendere il valore specifico da array bisogna mettere il + sia prima che dopo l'elemento
                        }

                          }

                      },
            error: function(x, e) {
              alert("non sono riuscito a trovare niente nell'archivio che riguarda questo cliente")

            }

                        });
                    
                      }

                return false;
            });
        })
    </script>



<script>//se cambia la dicitura da fattura,preventivo a nota di credito
        $(document).ready(function () {
            // catch the form's submit event
            $('#documento').on('change', function(){
                // create an AJAX call
                var tipo=$('#documento').val();
                var b='nota_di_credito'
                if(tipo==b){
                  $("#selezionafattura").remove()
                  $("#trova_fattura").append($("<select id='seleziona_fattura' class='form-control' name='selezionafattura'>").append("<option value='s'>Seleziona una fattura</option>"))
                   $("#fattura").prop("hidden",false);

                  



















               var ragionesociale=$('#ragionesociale').val();
              
               $('#seleziona_fattura').empty().append('<option value="s">Seleziona la fattura</option>');
               
                $.ajax({
                    data : {
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                      ragionesociale : ragionesociale,
                      },
                    url: "{% url 'ricercainvociecliente' %}",
                     type: 'POST',
                     dataType: 'json',
                    // on success
                    success: function (response) {
                     var array = response.customer_invoice;
                     
                     if (array != ''){

                       for (i in array) {   
                        console.log(array.value)
                                       
                        $("#seleziona_fattura").append("<option value="+array[i].invoice_id+">"+array[i].invoice_id+"</option>");//per prendere il valore specifico da array bisogna mettere il + sia prima che dopo l'elemento
                        }

                          }

                      },
            error: function(x, e) {
              alert("non sono riuscito a trovare niente nell'archivio che riguarda questo cliente")

            }

                        });
                    
                      }
              else{
                $("#fattura").prop("hidden",true);
                $("#seleziona_fattura").remove();
                 $("#trova_fattura").append($("<select id='selezionafattura' hidden class='form-control' name='selezionafattura'>").append("<option value='s'>Seleziona una fattura</option>"))

              }

                return false;
            });
        })
    </script>




{% endblock %}