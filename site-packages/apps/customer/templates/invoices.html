{% extends 'base.html' %}

{% block content %}

<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h4>Emetti nuova fattura<a type="button"  class="btn btn-sm " href="{% url 'new_invoice' %}"><i><img alt="nuova-fattura" src="/static/images/piu.svg" width="25px" title="Nuovo fattura"></i></a><i><img alt="nuova-fattura" src="/static/images/icona_fattura.svg" width="40px"></i></h4>
      </div>
     
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item">
              <a href="homepage.html">Home</a>
            </li>
            <li class="breadcrumb-item active">Lista fatture</li>
          </ol>
        </div>
      </div>
    </div><!-- /.container-fluid -->
  </section><!-- Main content -->

{% if invoices %}
  <section class="content">
<div class="container-fluid">
<div class="panel panel-primary">
	<div class="row">
	<div class="col-sm-2">
          <h3>Lista delle fatture</h3>
      </div>
	<div class="col-sm-3">
          <h5>Ultimo id della fattura inserita: <font color="#ff4d01">{{ ultimoid_invoice.invoice_id }} </font> </h5>
        </div>
              </div>
              <div class="row">
              	<p><small><font color="#ff4d01">*attenzione non superare 11 colonne visualizzate, se si eccede nel numero si potrebbe presentare qualche problema nella visualizzazione.</font></small></p>
              </div>
             
	<table  id="tabellafattura"  class="cell-border compact row-border stripe" style="width:100%">

		<thead>
			<tr>
			<th>Id della fattura</th>
			<th>Id clienti</th>
			<th>Nome/ragionesociale</th>
			<th>Codice Fiscale</th>
			<th>p.iva</th>
			<th>data emmissione</th>
			<th>data scadenza</th>
			<th>Stato fattura</th>
			<th>Stato cliente</th>
			<th class=".not-export-col text-center">Azioni possibili</th>
		</tr>
		</thead>
		<tbody>
		{% for invoice in invoices %}
		<tr>
			<td class="text-center"><B>{{ invoice.invoice_id }}</B></td>
			<td class="text-center">{{ invoice.customer_id }}</td>
			<td class="text-center"><B>{{ invoice.customer.ragionesociale }}</B></td>
			<td class="text-center">{{ invoice.customer.codicefiscale }}</td>
			<td class="text-center">{{ invoice.customer.piva }}</td>
			<td class="text-center">{{ invoice.date}}</td>
			<td class="text-center">{{ invoice.scadenza_fattura }}</td>
			<td class="visualizza-stato-fattura text-center"><B>{{ invoice.status }}</B></td>
			<td class="visualizza-stato text-center">{{ invoice.customer.stato_cliente_dato }}</td>
		<td class="text-right">
				<div class="btn-group" role="group">
				<a href="{% url 'update_status' invoice.invoice_id %}" class="btn btn-sm"><i><img alt="dettagli-clienti" src="/static/images/find-person.svg" width="32px" title="Dettagli"></i></a>
				<a href="mailto:{{ invoice.customer.email }}" class="btn btn-sm "><i><img alt="invia-email" src="/static/images/email.svg" width="32px" title="invia email"></i></a>
				<a href="mailto:{{ invoice.customer.email }}" class="btn btn-sm "><i><img alt="invia-sms" src="/static/images/sms-giallo.svg" width="32px" title="invia sms"></i></a>
				<a id="archivia"type="button" href="{% url 'nota_di_credito' invoice.invoice_id %}"class="btn btn-sm"><i><img alt="notadi credito" src="/static/images/nota_di_credito.svg" width="32px" title="archivia cliente"></i></a>
				</div>
		</td>
		</tr>
		
		{% endfor %}
		</tbody>
		<tfoot>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tfoot>
	</table>
</div>

</div>
</section>
</div>

<!--Questo script serve per la tabella dinamica. InitComplete serve per modificare i pulsanti da testo a icona.
	il dom serve a indicare ogni elemento della tabella e come devono essere sistemaati. Le lettere rappresentano:
	B=pulsanti, l=select per i risultati in una pagina, t=tabella, p=paginazione, i=informazioni di righe sulla tabella, f=filtro, barra delle ricerche. Per cambiare la lingua del plugin bisogna allegare l'url per language alla lingua corretta)
								|
								|
								V			
-->
<script type="text/javascript">
	$(document).ready(function() {
    $('#tabellafattura').DataTable({
    	initComplete: function () {
                $('.buttons-copy').html('<i><img alt="copia" src="/static/images/icon-copy.svg" width="20px" title="copia tabella"></i>');
                $('.buttons-csv').html('<i><img alt="copia" src="/static/images/icon-csv.svg" width="20px" title="scarica csv"></i>');
                $('.buttons-excel').html('<i><img alt="pdf" src="/static/images/icon-xlsx.svg" width="20px" title="scarica xls"></i>');
                $('.buttons-pdf').html('<i><img alt="pdf" src="/static/images/icon-pdf.svg" width="20px" title="scarica pdf"></i>');
                $('.buttons-print').html('<i><img alt="pdf" src="/static/images/icon-printer.svg" width="20px" title="stampa tabella"></i>');
                 $('.buttons-colvis').html('<i><img alt="pdf" src="/static/images/ordina-tabella.svg" width="20px" title="ordina visualizzazione colonna"> vedi colonne</i>');
                this.api().columns().every( function () {

                var column = this;
                var select = $('<select><option value=""></option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );
                        console.log(val)
 
                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );
 
                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
            } );

                
            },
            
            responsive: true,
             columnDefs: [{//serve per la visibilit√† delle colonne
      targets: [2,3,4,6,7,9,13,14],
      visible: false,
      searchable: true
    }],

            fixedHeader: true,
    		dom: "<'row dom_wrapper fh-fixedHeader'l<'col-sm col-md'><'col-sm col-md'>f>" +
    "<'row'<'col-sm col-md'Btr>>" +
    "<'row'<'col-sm col-md'i><'col-sm col-md'>p>",
    		buttons: [

    	

    		{
                extend: 'copyHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'csvHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'excelHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'pdfHtml5',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
                extend: 'print',
                exportOptions: {
                    columns: ':visible:not(:last-child)'
                }
            },
            {
				extend: 'colvis',
				text : 'vedicolonne',
				className: 'btn btn-primary'
			 },
            
  			],
    		language:{
    			"url": "//cdn.datatables.net/plug-ins/1.11.3/i18n/it_it.json",
    			"searchPlaceholder": "Cerca fattura"
},

});
    $("#tabellafattura").width("100%");

});
</script>
<script type="text/javascript">//questo serve per cambiare i colori dello stato cliente
$(document).ready(function() {
	var elements = document.getElementsByClassName("visualizza-stato");

for (var i = 0; i < elements.length; i++) {
  var value = elements[i].innerText || elements[i].textContent;
  
  if (value === 'archiviato') {
    elements[i].style.backgroundColor = '#a61022';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  } else if (value === 'Attivo') {
    elements[i].style.backgroundColor = '#177245';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'Interessato') {
    elements[i].style.backgroundColor = '#0C223F';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'Moroso') {
    elements[i].style.backgroundColor = '#f4a900';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'Disattivato') {
    elements[i].style.backgroundColor = '#676767';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
}

});
</script>



<script type="text/javascript">//questo serve per cambiare i colori dello stato fattura
$(document).ready(function() {
	var elements = document.getElementsByClassName("visualizza-stato-fattura");

for (var i = 0; i < elements.length; i++) {
  var value = elements[i].innerText || elements[i].textContent;
  
  if (value === 'non-pagato') {
    elements[i].style.backgroundColor = '#a61022';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  } else if (value === 'pagato') {
    elements[i].style.backgroundColor = '#177245';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'Nota di credito') {
    elements[i].style.backgroundColor = '#0C223F';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  else if (value === 'pagamento parziale') {
    elements[i].style.backgroundColor = '#f4a900';
    elements[i].style.color = '#ffffff';
    elements[i].style.fontWeight = "bold" 
  }
  
}

});
</script>




<!-- END delete confirmation modal -->

{% else %}

<div class="alert alert-warning">No invoices!</div>

{% endif %}
</div>
</section>
</div>


{% endblock %}
