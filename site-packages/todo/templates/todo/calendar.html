{% extends "base.html" %}
{% load static %}


{% block content %}
 <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
  <h2>Agenda</h2>
</div>
</div>
  </div>
  </section>
   

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-3">
           <div class="sticky-top mb-3">
              <div class="card">
                <div class="card-header">
                 <h4>Manage your events<span class="badge badge-primary"></span></h4>
                </div>
                <div class="card-body">

	  
	   <form action="" method="post">
	   {% csrf_token %}
	   <div class="form-group">

	<!-- color choice -->
	<div class="input-group mb-3">
	 <select name="color" class="form-control select2bs4" style="width: 100%;">
                    <option value="#0275d8">Blue</option>
                    <option value="#999999">Gray</option>
                    <option value="#5cb85c">Green</option>
                    <option value="#f0ad4e">Yellow</option>
					<option value="#d9534f">Red</option>
					<!-- icons creation powered by www.iconsdb.com -->

		</select> 
		</div>
		
		
		<div class="input-group mb-3">
		  <input type="text" class="form-control pull-right" name="title" placeholder="Title" required>
		</div>

			<!-- start time -->
                <div class="form-group">
                  <label>Start time:</label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text"><i class="far fa-clock"></i></span>
                    </div>
                    <input type="text" name="start" class="form-control pull-right" id="reservationtime_start">
                  </div>
                </div>
			
			
		<div class="form-group">
		<input type="checkbox" name="allDay" class="allDay" id="allDay">
		<label class="form-check-label" for="allDay">All day</label>
		</div>
		
			<div class="togglediv_endtime">
				<!-- end time -->
                <div class="form-group">
                  <label>End time:</label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text"><i class="far fa-clock"></i></span>
                    </div>
                    <input type="text" name="end" class="form-control pull-right" id="reservationtime_end">
                  </div>
                </div>
				 </div>
				
		<!--
		<div class="input-group mb-3">
		  <input type="text" name="start" onfocus="(this.type='date')" class="form-control pull-right" placeholder="Start time" required>
		</div>
		-->
		
		<div class="form-group">
		<input type="checkbox" name="isRecur" class="isRecur" id="isRecur">
		<label class="form-check-label" for="isRecur">Ricorrente</label>
		</div>
		
		<!-- begin recurrence dates -->
		<div class="togglediv_recurrence">
		<div class="input-group mb-3">
		  <input type="text" name="startRecur" onfocus="(this.type='date')" class="form-control pull-right" placeholder="Start recurrence date">
		</div>
		
		<div class="input-group mb-3">
		 <input type="text" name="endRecur" onfocus="(this.type='date')" class="form-control pull-right" placeholder="End recurrence date">
		</div>
		
		<div class="input-group mb-3">
		{{ form.daysOfWeek }}
		</div>
		</div>
		<!-- end recurrence dates -->
		
		
		<div class="input-group mb-3">
		<div class="form-check">
		<input type="checkbox" name="notify" class="form-check-input" id="notify" data-toggle="tooltip" data-placement="top" title="Riceverai una e-mail il giorno prima della scadenza">
		<label class="form-check-label" for="notify" data-toggle="tooltip" data-placement="top" title="Riceverai una e-mail il giorno prima della scadenza">Invia Promemoria</label>
		 </div>
		 </div>
		 
	   <button class="btn btn-primary" type="submit" name="submit" value="Submit">Add</button>
		</div>
		 </form>
	  <!-- /.form group -->


		 <!-- the events -->
		  <div id="external-events">
		  </div>
		</div>
		<!-- /.card-body -->
	  </div>
	  <!-- /.card -->
	</div>
  </div>


  <!-- /.col -->
  <div class="col-md-9">
	<div class="card card-primary">
	  <div class="card-body p-0">
		<!-- THE CALENDAR -->
		<div id="calendar"></div>
	  </div>
	  <!-- /.card-body -->
	</div>
	<!-- /.card -->
  </div>
  <!-- /.col -->
</div>
<!-- /.row -->
</div><!-- /.container-fluid -->
</section>
<!-- /.content -->
</div>
<!-- /.content-wrapper -->
  

  <script>
  $(function () {

    /* initialize the external events
     -----------------------------------------------------------------*/
    function ini_events(ele) {
      ele.each(function () {

        // create an Event Object (https://fullcalendar.io/docs/event-object)
        // it doesn't need to have a start or end
        var eventObject = {
          title: $.trim($(this).text()) // use the element's text as the event title
        }

        // store the Event Object in the DOM element so we can get to it later
        $(this).data('eventObject', eventObject)

        // make the event draggable using jQuery UI
        $(this).draggable({
          zIndex        : 1070,
          revert        : true, // will cause the event to go back to its
          revertDuration: 0  //  original position after the drag
        })

      })
    }

    ini_events($('#external-events div.external-event'))

    /* initialize the calendar
     -----------------------------------------------------------------*/
    //Date for the calendar events (dummy data)
    var date = new Date()
    var d    = date.getDate(),
        m    = date.getMonth(),
        y    = date.getFullYear()

    var Calendar = FullCalendar.Calendar;
    var Draggable = FullCalendar.Draggable;

    var containerEl = document.getElementById('external-events');
    var checkbox = document.getElementById('drop-remove');
    var calendarEl = document.getElementById('calendar');

    // initialize the external events
    // -----------------------------------------------------------------

    new Draggable(containerEl, {
      itemSelector: '.external-event',
      eventData: function(eventEl) {
        return {
          title: eventEl.innerText,
          backgroundColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
          borderColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
          textColor: window.getComputedStyle( eventEl ,null).getPropertyValue('color'),
        };
      }
    });

    var calendar = new Calendar(calendarEl, {
	slotDuration: '01:00', 	// 1 hour
      headerToolbar: {
        left  : 'prev,next today',
        center: 'title',
        right : 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      themeSystem: 'bootstrap',
	  //weekNumbers: true,
      navLinks: true,
    
	eventSources: 
	[
    // your event source
    {
      url: '{% url 'todo:events_list' %}', // use the `url` property
      //color: 'yellow',    // an option!
      //textColor: 'black'  // an option!
    }

    // any other sources...

	],
	
	
	editable  : false,
	//eventClick: function(info) {
    //alert('Event: ' + info.event.title);
	//alert('Vuoi rimuovere questo evento?');

	
    //alert('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY);
    //alert('View: ' + info.view.type);

    // change the border color just for fun
    //info.el.style.borderColor = 'red';
	//}
	});
	
	
    calendar.render();
	
    //$('#calendar').fullCalendar()
	
	calendar.on('eventClick', function (info) {
	info.el.style.borderColor = 'red';
	//alert('Vuoi rimuovere questo evento?');
	//calendar.getEventById(info.event.id).remove();
    //var ciao = calendar.getEventById(info.event.id);
	//console.log(ciao);
	var deleteMsg = confirm("Voulez-vous vraiment supprimer cette activit√© ?");
	if (deleteMsg) {
	  // Get event ID
	  var vEventId = info.event.id;
	  // Remove event from fullcalendar
	  info.event.remove();
	  // Call ajax to remove event from database table
	  var data1 = {eventId: vEventId};
	  $.ajax({
		url: '{% url 'todo:delete_event' %}',
		dataType: 'text',
		method: "POST",
		data : {
		csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
		data: JSON.stringify(data1),
		},
		success: function(data, status, xhr){
			//console.log(data);
			//console.log(data1);
			//console.log( JSON.stringify(data1));
		},
		error: function(xhr, status, error){
			//console.log(error);
			//console.log(data1);
			//console.log(xhr.responseText);
		}
	  });
	}
  
	
	});


  })
</script>
<script>
/*
$('.form-check-input').click(function() {
    //alert($(this).attr('id'));  //-->this will alert id of checked checkbox.
	var data1 = $(this).attr('id');
       if(this.checked){
            $.ajax({
                type: "POST",
                url: '{% url 'todo:events_list' %}',
                data: {
				csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken').val(),
				data: $(this).attr('id'), //--> send id of checked checkbox on other page
				},
				success: function(data) {
                    alert('it worked');
                    alert(data1);
                    //$('#container').html(data); //--> send id of checked checkbox on <div id="container">
                },
                error: function() {
                    alert('it broke');
                }
 
            });

            }
      });
	  */
</script>
<script>
//Show hide functions
$(".allDay").click(function() {
    if($(this).is(":checked")) {
        $(".togglediv_endtime").hide();
    } else {
        $(".togglediv_endtime").show();
    }
});

$(".togglediv_recurrence").hide();
$(".isRecur").click(function() {
    if($(this).is(":checked")) {
        $(".togglediv_recurrence").show();
    } else {
        $(".togglediv_recurrence").hide();
    }
});
</script>
<script>
//Date range picker with time picker
$(function () {
    $('#reservationtime_start').daterangepicker({
      timePicker: true,
	  timePicker24Hour: true,
	  singleDatePicker: true,
      timePickerIncrement: 30,
      locale: {
        format: 'DD/MM/YYYY HH:mm'
      }
    })
	 $('#reservationtime_end').daterangepicker({
      timePicker: true,
	  timePicker24Hour: true,
	  singleDatePicker: true,
      timePickerIncrement: 30,
      locale: {
        format: 'DD/MM/YYYY HH:mm'
      }
    })
})
</script>
<script>
//Add icon 
function formatText (icon) {
    //return $('<span><i class="fas ' + $(icon.element).data('icon') + '"></i> ' + icon.text + '</span>');
	if (!icon.id) { return icon.text; }
	var $icon = $(
    '<span><img src="{% static 'plugins/fontawesome-free/icons/' %}' + icon.text.toLowerCase() +
    '.png"/> '  + icon.element.text + '</span>');
 return $icon;
};

//Initialize Select2 Elements
 $(function () {
     //Initialize Select2 Elements
    $('.select2bs4').select2({
	placeholder: 'Select event color',
	allowClear: true,
	theme: 'bootstrap4',
    templateResult: formatText,
    })
	
	})
</script>
{% endblock %}
