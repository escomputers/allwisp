{% extends "base.html" %}



{% block content %}
 <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
  <h2>Calendario</h2>
</div>
</div>
  </div>
  </section>
   

        <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-3">
           <div class="sticky-top mb-3">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title">Aggiungi Evento</h4>
                </div>
                <div class="card-body">

              
			   <form action="" method="post">
			   {% csrf_token %}
			   <div class="form-group">
			  <div class="input-group mb-3">
				{{ form.type }}
                </div>
				<div class="input-group mb-3">
                  <input type="text" class="form-control pull-right" name="title" placeholder="Title" required>
                </div>
			
				<div class="input-group mb-3">
                  <input type="text" name="start" onfocus="(this.type='date')" class="form-control pull-right" placeholder="Start date" required>
                </div>
				
				<div class="input-group mb-3">
                 <input type="text" name="end" onfocus="(this.type='date')" class="form-control pull-right" placeholder="End date" required>
                </div>
				
				<div class="input-group mb-3">
				<div class="form-check">
				<input type="checkbox" name="notify" class="form-check-input" id="notify" data-toggle="tooltip" data-placement="top" title="Riceverai una e-mail il giorno prima della scadenza">
                <label class="form-check-label" for="notify" data-toggle="tooltip" data-placement="top" title="Riceverai una e-mail il giorno prima della scadenza">Invia Promemoria</label>
				 </div>
				 </div>
				 
               <input class="btn btn-primary" type="submit" name="submit" value="Submit" />
			    </div>
			     </form>
              <!-- /.form group -->


                 <!-- the events -->
                  <div id="external-events">
                  </div>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
            </div>
		  </div>
 

          <!-- /.col -->
          <div class="col-md-9">
            <div class="card card-primary">
              <div class="card-body p-0">
                <!-- THE CALENDAR -->
                <div id="calendar"></div>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  

  <script>
  $(function () {

    /* initialize the external events
     -----------------------------------------------------------------*/
    function ini_events(ele) {
      ele.each(function () {

        // create an Event Object (https://fullcalendar.io/docs/event-object)
        // it doesn't need to have a start or end
        var eventObject = {
          title: $.trim($(this).text()) // use the element's text as the event title
        }

        // store the Event Object in the DOM element so we can get to it later
        $(this).data('eventObject', eventObject)

        // make the event draggable using jQuery UI
        $(this).draggable({
          zIndex        : 1070,
          revert        : true, // will cause the event to go back to its
          revertDuration: 0  //  original position after the drag
        })

      })
    }

    ini_events($('#external-events div.external-event'))

    /* initialize the calendar
     -----------------------------------------------------------------*/
    //Date for the calendar events (dummy data)
    var date = new Date()
    var d    = date.getDate(),
        m    = date.getMonth(),
        y    = date.getFullYear()

    var Calendar = FullCalendar.Calendar;
    var Draggable = FullCalendar.Draggable;

    var containerEl = document.getElementById('external-events');
    var checkbox = document.getElementById('drop-remove');
    var calendarEl = document.getElementById('calendar');

    // initialize the external events
    // -----------------------------------------------------------------

    new Draggable(containerEl, {
      itemSelector: '.external-event',
      eventData: function(eventEl) {
        return {
          title: eventEl.innerText,
          backgroundColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
          borderColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
          textColor: window.getComputedStyle( eventEl ,null).getPropertyValue('color'),
        };
      }
    });

    var calendar = new Calendar(calendarEl, {
      headerToolbar: {
        left  : 'prev,next today',
        center: 'title',
        right : 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      themeSystem: 'bootstrap',
	  //weekNumbers: true,
      navLinks: true,
    
	eventSources: 
	[
    // your event source
    {
      url: '{% url 'todo:events_list' %}', // use the `url` property
      //color: 'yellow',    // an option!
      //textColor: 'black'  // an option!
    }

    // any other sources...

	],
	

	editable  : true,
	//eventClick: function(info) {
    //alert('Event: ' + info.event.title);
	//alert('Vuoi rimuovere questo evento?');


    //alert('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY);
    //alert('View: ' + info.view.type);

    // change the border color just for fun
    //info.el.style.borderColor = 'red';
	//}
	});
	

	
    calendar.render();
    //$('#calendar').fullCalendar()
	
	calendar.on('eventClick', function (info) {
	info.el.style.borderColor = 'red';
	//alert('Vuoi rimuovere questo evento?');
	//calendar.getEventById(info.event.id).remove();
    //var ciao = calendar.getEventById(info.event.id);
	//console.log(ciao);
	var deleteMsg = confirm("Voulez-vous vraiment supprimer cette activit√© ?");
	if (deleteMsg) {
	  // Get event ID
	  var vEventId = info.event.id;
	  // Remove event from fullcalendar
	  info.event.remove();
	  // Call ajax to remove event from database table
	  var data1 = {eventId: vEventId};
	  $.ajax({
		url: '{% url 'todo:delete_event' %}',
		dataType: 'text',
		method: "POST",
		data : {
		csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
		data: JSON.stringify(data1),
		},
		success: function(data, status, xhr){
			//console.log(data);
			//console.log(data1);
			//console.log( JSON.stringify(data1));
		},
		error: function(xhr, status, error){
			//console.log(error);
			//console.log(data1);
			//console.log(xhr.responseText);
		}
	  });
	}
  
	
	});


  })
</script>
<script>
/*
$('.form-check-input').click(function() {
    //alert($(this).attr('id'));  //-->this will alert id of checked checkbox.
	var data1 = $(this).attr('id');
       if(this.checked){
            $.ajax({
                type: "POST",
                url: '{% url 'todo:events_list' %}',
                data: {
				csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken').val(),
				data: $(this).attr('id'), //--> send id of checked checkbox on other page
				},
				success: function(data) {
                    alert('it worked');
                    alert(data1);
                    //$('#container').html(data); //--> send id of checked checkbox on <div id="container">
                },
                error: function() {
                    alert('it broke');
                }
 
            });

            }
      });
	  */
</script>
{% endblock %}